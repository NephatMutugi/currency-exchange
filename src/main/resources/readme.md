-- DIGITAL LENDING DB TO LOG CALLBACKS
-- HEADER FIELDS ARE COMMON FOR ALL REQUESTS AND RESPONSES
CREATE TABLE DIGITAL_LENDING_TRANSACTION
(


--     UNIQUE ID FOR EVERY REQUEST GENERATED
ID                          NUMBER GENERATED BY DEFAULT AS IDENTITY,

/* HEADER FIELDS
THESE ARE COMMON TO ALL REQUESTS AND RESPONSES
*/
MESSAGE_ID                  VARCHAR2(50) NOT NULL,
CONVERSATION_ID             VARCHAR2(50) NOT NULL,
CHANNEL_CODE                VARCHAR2(50) NOT NULL,
CHANNEL_NAME                VARCHAR2(50) NOT NULL,
SERVICE_NAME                VARCHAR2(50) NOT NULL,
SERVICE_MODE                VARCHAR2(20),
CALLBACK_URL                VARCHAR2(200),

-- ***** INCOMING REQUESTS *****

-- COMMON FIELDS

    SLCUSTOMER_ID               VARCHAR2(50),
    SLCUSTOMER_ACCOUNT_NUMBER   VARCHAR2(50),
    INCOMING_REQUEST_BODY       CLOB,
    EXTERNAL_ACCOUNT            VARCHAR2(50),
    EXTERNAL_ID                 VARCHAR2(50),

-- CUSTOMER FIELDS

    CUSTOMER_ID_TYPE            VARCHAR2(20),
    CUSTOMER_ID_NUMBER          VARCHAR2(20),
    CUSTOMER_ORGANISATION_NAME  VARCHAR2(50),
    MSISDN                      VARCHAR2(20),

-- LOAN FIELDS
LOAN_PRODUCT_ID             VARCHAR2(20),
LOAN_TERM                   VARCHAR2(50),
LOAN_AMOUNT                 VARCHAR2(20),
LOAN_DISBURSEMENT_TYPE      VARCHAR2(20),


-- **************************** RESPONSE *****************************


-- ****** THIRD PARTY RESPONSE {THIS COMES FROM SOPRA}******

    TRANSACTION_STATUS          VARCHAR2(3),
    THIRD_PARTY_STATUS_CODE     VARCHAR2(50),
    THIRD_PARTY_STATUS_DESC     VARCHAR2(200),
    THIRD_PARTY_CALLBACK_STATUS VARCHAR2(50),
-- These fields are for both customer and loan creation
SL_REQUEST_ID               VARCHAR2(50),


    STATUS_CODE                 VARCHAR2(3),
    STATUS_DESCRIPTION          VARCHAR2(50),
    CALLBACK_PAYLOAD            CLOB


);


ALTER TABLE DIGITAL_LENDING_TRANSACTION
RENAME TO DIGITAL_LENDING_TRANSACTIONS;

SELECT * FROM LOYALTYINHOUSE.DIGITAL_LENDING_TRANSACTIONS;

ALTER TABLE  DIGITAL_LENDING_TRANSACTIONS
ADD TRANSACTION_STATUS_DESC NVARCHAR2(255);

